!function(e){var n={};n.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},n.rowClicker=function(a){"undefined"!=typeof n.conf.onBeforeRowClick&&n.isFunction(n.conf.onBeforeRowClick)&&n.conf.onBeforeRowClick.apply(n.getPublicObj(),[a]);var l=e(a.currentTarget);l.is("tr")||(l=l.parentsUntil("tr").parent()),$row=l;var t=$row.attr("id");return $row.data("child")&&($row.hasClass("contracted")?($row.removeClass("contracted").addClass("expanded"),n.toggleChildren(t,!0)):($row.removeClass("expanded").addClass("contracted"),n.toggleChildren(t,!1)),n.updateLines()),"undefined"!=typeof n.conf.onAfterRowClick&&n.isFunction(n.conf.onAfterRowClick)&&n.conf.onAfterRowClick.apply(n.getPublicObj(),[a]),n.getPublicObj()},n.updateLines=function(){var a="",l="";if($prevRow=null,n.caller.find("tr:not(.hidden):not(.hiding)").each(function(){if($row=e(this),!$row.hasClass("header")){a=$row.data("level");for(var t=n.maxLevel;t>0;t--)$row.removeClass("l"+t+"-first").removeClass("l"+t+"-last");var o="";if(a!=l)if(""!=l&&l>a)for(var t=l;t>=a;t--)$prevRow.addClass(" l"+parseInt(t)+"-last");else""!=l&&a>l&&$prevRow.addClass(" l"+l+"-first");$row.addClass(o),l=a,$prevRow=$row}}),null!=$prevRow&&""!=l&&l>1)for(var t=l-1;t>0;t--)$prevRow.addClass(" l"+parseInt(t)+"-last");return n.getPublicObj()},n.toggleChildren=function(a,l,t){var o=!1,r=!1,d=null,i=0;return n.caller.find("tr").each(function(){var n=e(this),t=n.attr("id"),c=n.data("level"),s=!1;o||t!=a?o&&!r&&null!=d&&c==i?r=!0:l&&o&&!r&&null!=d&&c!=i+1?s=!0:!l&&o&&!r&&null!=d&&i>c&&(r=!0,s=!0):(o=!0,i=c),s||!o||r||t==a||(l?(n.removeClass("hidden"),n.find("td").wrapInner('<div style="display: none;" />').parent().find("td > div").slideDown(100,function(){var n=e(this);n.replaceWith(n.contents())})):(n.addClass("hiding"),n.find("td").wrapInner('<div style="" />').parent().find("td > div").slideUp(100,function(){var a=e(this);a.replaceWith(a.contents()),n.addClass("hidden"),n.removeClass("hiding")}),n.removeClass("expanded"),n.addClass("contracted"))),d=c}),n.getPublicObj()},n.updateData=function(){n.caller.data("tabelizer",n)},n.maxLevel=0,n.init=function(){var a="",l="";return $prevRow=null,n.caller.find("tr").each(function(){if($row=e(this),!$row.hasClass("header")){a=$row.data("level");var t="l"+a+" contracted "+(a>1?" hidden":"");a>n.maxLevel&&(n.maxLevel=parseInt(a)),$row.addClass(t),$firstCol=e($row.children("td")[0]);for(var o='<div class="row-label">'+$firstCol.html()+"</div>",r='<div class="control"> ',d=0;a-1>=d;d++)r+=' <div class="line level'+(d+1)+'"><div class="vert"></div><div class="horz"></div></div> ';r+="</div>",$firstCol.html(r+' <div class="expander '+($row.data("child")?"":"hidden")+'"></div> '+o),n.conf.fullRowClickable?$row.on("click",n.conf.onRowClick):$row.find(".expander").on("click",n.conf.onRowClick),l=a,$prevRow=$row}}),n.expand(),"undefined"!=typeof n.conf.onReady&&n.isFunction(n.conf.onReady)&&n.conf.onReady.apply(n.getPublicObj(),[]),n.getPublicObj()},n.expand=function(){n.caller.find("tr").each(function(){var a=e(this),l=a.attr("id"),t=a.data("level");a.hasClass("header")||(t<n.conf.expandLevel?a.hasClass("contracted")&&a.data("child")&&(a.removeClass("contracted").addClass("expanded"),n.toggleChildren(l,!0)):a.hasClass("expanded")&&(a.removeClass("expanded").addClass("contracted"),n.toggleChildren(l,!1)))}),n.updateLines()},n.getPublicObj=function(){return{options:n.conf,toggleChildren:n.toggleChildren,updateLines:n.updateLines,rowClicker:n.rowClicker,maxLevel:n.maxLevel,updateData:n.updateData}},n.conf={onRowClick:n.rowClicker,fullRowClickable:!0,onBeforeRowClick:null,onAfterRowClick:null,onReady:null,expandLevel:100},e.fn.tabelize=function(a){var l=this.data("tabelizer");if("undefined"==typeof l)e.extend(n.conf,a),n.caller=this,n.init();else{n=l;var t=n.conf.expandLevel;e.extend(n.conf,a),"undefined"!=typeof a.expandLevel&&a.expandLevel!==t&&n.expand()}return n.updateData(),n.getPublicObj()}}(jQuery);